<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Matriz SWOT + GUT - PLANO DE VOO ERO em Tucum√£</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Estilos -->
  <style>
    :root {
      --bg: #04141f;
      --bg-elevated: #071d2c;
      --accent-1: #00a19a; /* teal / ERO-style */
      --accent-2: #f27f3d; /* cobre / laranja */
      --accent-3: #ffd166; /* amarelo destaque */
      --accent-4: #e63946; /* alerta / risco */
      --accent-muted: #64748b;
      --border-subtle: #123047;
      --text-main: #e5f4ff;
      --text-soft: #9fb3c8;
      --card-radius: 14px;
      --shadow-soft: 0 22px 45px rgba(4, 20, 31, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #092338 0, var(--bg) 55%, var(--bg) 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      max-width: 1280px;
      width: 100%;
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 16px;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .title-block {
      min-width: 260px;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    .title span.accent {
      background: linear-gradient(120deg, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .title-plan {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text-soft);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-top: 4px;
      max-width: 520px;
    }

    .header-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 6px 10px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-soft);
      background: linear-gradient(120deg, rgba(7, 29, 44, 0.95), rgba(7, 29, 44, 0.8));
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, var(--accent-1), #016d68);
      box-shadow: 0 0 10px rgba(0, 161, 154, 0.8);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.18s ease-out;
      white-space: nowrap;
      position: relative;
      overflow: hidden;
    }

    .btn-menu {
      background: rgba(7, 29, 44, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: var(--text-main);
      box-shadow: 0 10px 25px rgba(4, 20, 31, 0.6);
    }

    .btn-menu::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.2s ease-out;
      z-index: -1;
    }

    .btn-pdf {
      background: linear-gradient(135deg, var(--accent-2), #ff9a5a);
      border-color: rgba(242, 127, 61, 0.7);
      color: #04141f;
    }

    .btn-pdf::before {
      background: radial-gradient(circle at top, rgba(242, 127, 61, 0.45), transparent 60%);
    }

    .btn-excel {
      background: linear-gradient(135deg, var(--accent-1), #5be7d0);
      border-color: rgba(0, 161, 154, 0.8);
      color: #04141f;
    }

    .btn-excel::before {
      background: radial-gradient(circle at top, rgba(0, 161, 154, 0.4), transparent 60%);
    }

    .btn-menu:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(4, 20, 31, 0.85);
    }

    .btn-menu:hover::before {
      opacity: 1;
    }

    .icon {
      font-size: 1rem;
    }

    .main-card {
      background: radial-gradient(circle at top left, #0c2237 0, var(--bg-elevated) 55%, var(--bg-elevated) 100%);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
    }

    .context-card {
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.5);
      background: radial-gradient(circle at top left, rgba(7,29,44,0.98), var(--bg-elevated));
      padding: 10px 12px 12px;
      margin-bottom: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .context-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      font-weight: 600;
    }

    .context-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 12px;
      margin-top: 4px;
    }

    .context-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.78rem;
    }

    .context-field label {
      color: var(--text-soft);
    }

    .context-field input,
    .context-field textarea {
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid rgba(51,65,85,0.9);
      background: rgba(7,29,44,0.96);
      color: var(--text-main);
      font-size: 0.78rem;
      resize: vertical;
    }

    .context-field textarea {
      min-height: 40px;
    }

    @media (max-width: 720px) {
      .context-grid {
        grid-template-columns: 1fr;
      }
    }

    .tab-header {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 14px;
    }

    .tab-btn {
      flex: 1 1 120px;
      min-width: 120px;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      border: 1px solid transparent;
      cursor: pointer;
      background: radial-gradient(circle at top, rgba(7,29,44,0.9), rgba(7,29,44,0.7));
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.18s ease-out;
    }

    .tab-btn span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
    }

    .tab-btn[data-tab="forcas"] span.dot { background: var(--accent-1); }
    .tab-btn[data-tab="fraquezas"] span.dot { background: var(--accent-4); }
    .tab-btn[data-tab="oportunidades"] span.dot { background: var(--accent-2); }
    .tab-btn[data-tab="ameacas"] span.dot { background: var(--accent-3); }
    .tab-btn[data-tab="resumo"] span.dot { background: var(--accent-muted); }

    .tab-btn.active {
      color: #e5fef3;
      border-color: rgba(148,163,184,0.6);
      background: linear-gradient(135deg, rgba(0,161,154,0.16), rgba(242,127,61,0.24));
      box-shadow: 0 14px 34px rgba(4,20,31,0.9);
    }

    .tab-btn .label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .summary-chip {
      flex: 1 1 180px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      background: radial-gradient(circle at top left, rgba(7,29,44,0.95), rgba(7,29,44,0.82));
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .summary-chip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }

    .summary-chip-title {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }

    .summary-chip-value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .summary-chip-sub {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .tab-content {
      display: none;
      margin-top: 10px;
    }

    .tab-content.active {
      display: block;
    }

    .table-wrapper {
      margin-top: 6px;
      border-radius: var(--card-radius);
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top left, rgba(7,29,44,0.98), var(--bg-elevated));
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    thead {
      background: linear-gradient(135deg, rgba(148,163,184,0.15), rgba(7,29,44,0.9));
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(7,16,28,0.9);
      vertical-align: middle;
    }

    th {
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    tbody tr:nth-child(even) {
      background: rgba(7,29,44,0.75);
    }

    tbody tr:nth-child(odd) {
      background: rgba(7,29,44,0.95);
    }

    tbody tr:hover {
      background: rgba(30,64,175,0.45);
    }

    input[type="text"] {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid rgba(51,65,85,0.9);
      background: rgba(7,29,44,0.9);
      color: var(--text-main);
      font-size: 0.8rem;
    }

    select {
      width: 100%;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid rgba(51,65,85,0.9);
      background: rgba(7,29,44,0.96);
      color: var(--text-main);
      font-size: 0.78rem;
    }

    .score-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 52px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.8rem;
      background: radial-gradient(circle at top, rgba(0,161,154,0.18), rgba(242,127,61,0.18));
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .row-actions {
      display: flex;
      gap: 6px;
    }

    .btn-icon {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      background: rgba(7,29,44,0.9);
      color: var(--text-soft);
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease-out;
    }

    .btn-icon:hover {
      background: rgba(7,29,44,1);
      color: #e2e8f0;
    }

    .table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: radial-gradient(circle at top left, rgba(7,29,44,1), rgba(7,29,44,0.85));
      border-top: 1px solid rgba(7,16,28,0.9);
    }

    .table-footer-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .table-footer-highlight {
      font-weight: 600;
      color: #e5fef3;
    }

    .gut-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .gut-pill {
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(7,29,44,0.9);
    }

    .add-row-btn {
      font-size: 0.78rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(7,29,44,0.9);
      color: var(--text-main);
      border: 1px dashed rgba(148,163,184,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .add-row-btn:hover {
      background: rgba(7,29,44,1);
    }

    .resumo-radar-card {
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      background: radial-gradient(circle at top left, rgba(7,29,44,0.95), rgba(7,29,44,0.82));
      padding: 10px 12px 16px;
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .resumo-radar-card canvas {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }

    .resumo-grid {
      display: grid;
      grid-template-areas:
        "forcas oportunidades"
        "fraquezas ameacas";
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .resumo-card {
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      background: radial-gradient(circle at top left, rgba(7,29,44,0.95), rgba(7,29,44,0.82));
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .resumo-card-forcas { grid-area: forcas; }
    .resumo-card-fraquezas { grid-area: fraquezas; }
    .resumo-card-oportunidades { grid-area: oportunidades; }
    .resumo-card-ameacas { grid-area: ameacas; }

    .resumo-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }

    .resumo-card-title {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }

    .resumo-card-tag {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .resumo-list {
      margin-left: 18px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .resumo-item-titulo {
      font-size: 0.78rem;
      margin-bottom: 3px;
    }

    .resumo-item-form {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 0.72rem;
      margin-bottom: 2px;
    }

    .resumo-item-form input,
    .resumo-item-form select {
      flex: 1 1 120px;
      min-width: 120px;
      padding: 3px 6px;
      border-radius: 6px;
      border: 1px solid rgba(51,65,85,0.9);
      background: rgba(7,29,44,0.96);
      color: var(--text-main);
      font-size: 0.72rem;
    }

    @media (max-width: 720px) {
      .resumo-grid {
        grid-template-areas:
          "forcas"
          "oportunidades"
          "fraquezas"
          "ameacas";
        grid-template-columns: 1fr;
      }
    }
  </style>

  <!-- Bibliotecas para PDF, Excel e Radar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="header">
      <div class="title-block">
        <div class="title">
          Matriz <span class="accent">SWOT + GUT</span>
          <span class="title-plan">‚Äì PLANO DE VOO ERO em Tucum√£</span>
        </div>
        <div class="subtitle">
          Preencha for√ßas, fraquezas, oportunidades e amea√ßas, atribua notas GUT
          e veja o ranking autom√°tico com os TOP 5 na aba Resumo. Este painel √© base
          para constru√ß√£o do A3 estrat√©gico.
        </div>
      </div>
      <div class="header-actions">
        <div class="pill">
          <span class="pill-dot"></span>
          Modo interativo ‚Äì ranking em tempo real
        </div>
        <button class="btn btn-menu btn-pdf" id="btnExportPDF">
          <span class="icon">üìÑ</span> Exportar PDF
        </button>
        <button class="btn btn-menu btn-excel" id="btnExportExcel">
          <span class="icon">üìä</span> Exportar Excel
        </button>
      </div>
    </header>

    <main class="main-card">
      <!-- Bloco de contexto A3 -->
      <section class="context-card">
        <div class="context-title">Contexto do A3 estrat√©gico</div>
        <div class="context-grid">
          <div class="context-field">
            <label for="ctx-tema">Nome do A3 / Tema</label>
            <input id="ctx-tema" type="text" placeholder="Ex.: Aumento de produtividade na planta de Tucum√£">
          </div>
          <div class="context-field">
            <label for="ctx-objetivo">Objetivo estrat√©gico</label>
            <input id="ctx-objetivo" type="text" placeholder="Ex.: +10% de produ√ß√£o com seguran√ßa e custo controlado">
          </div>
          <div class="context-field">
            <label for="ctx-escopo">Escopo / Fronteiras</label>
            <textarea id="ctx-escopo" placeholder="O que est√° dentro e fora do escopo deste A3."></textarea>
          </div>
          <div class="context-field">
            <label for="ctx-periodo">Per√≠odo de an√°lise</label>
            <input id="ctx-periodo" type="text" placeholder="Ex.: 2025-2026, 2¬∫ semestre, etc.">
          </div>
          <div class="context-field">
            <label for="ctx-area">√Årea / Unidade respons√°vel</label>
            <input id="ctx-area" type="text" placeholder="Ex.: Opera√ß√µes Tucum√£, Manuten√ß√£o, etc.">
          </div>
          <div class="context-field">
            <label for="ctx-time">Time / Workshop</label>
            <input id="ctx-time" type="text" placeholder="Ex.: nomes das pessoas / c√©lulas envolvidas">
          </div>
          <div class="context-field">
            <label for="ctx-facilitador">Facilitador</label>
            <input id="ctx-facilitador" type="text" placeholder="Ex.: nome do facilitador do A3">
          </div>
          <div class="context-field">
            <label for="ctx-data">Data da sess√£o</label>
            <input id="ctx-data" type="date">
          </div>
        </div>
      </section>

      <!-- Abas -->
      <div class="tab-header">
        <button class="tab-btn active" data-tab="forcas">
          <span class="dot"></span>
          <span class="label">For√ßas</span>
        </button>
        <button class="tab-btn" data-tab="fraquezas">
          <span class="dot"></span>
          <span class="label">Fraquezas</span>
        </button>
        <button class="tab-btn" data-tab="oportunidades">
          <span class="dot"></span>
          <span class="label">Oportunidades</span>
        </button>
        <button class="tab-btn" data-tab="ameacas">
          <span class="dot"></span>
          <span class="label">Amea√ßas</span>
        </button>
        <button class="tab-btn" data-tab="resumo">
          <span class="dot"></span>
          <span class="label">Resumo SWOT</span>
        </button>
      </div>

      <!-- Resumo r√°pido -->
      <div class="summary-row">
        <div class="summary-chip">
          <div class="summary-chip-header">
            <span class="summary-chip-title">For√ßas</span>
            <span class="summary-chip-value" data-summary-score="forcas">0</span>
          </div>
          <div class="summary-chip-sub">
            <span data-summary-items="forcas">0</span> itens avaliados
          </div>
        </div>
        <div class="summary-chip">
          <div class="summary-chip-header">
            <span class="summary-chip-title">Fraquezas</span>
            <span class="summary-chip-value" data-summary-score="fraquezas">0</span>
          </div>
          <div class="summary-chip-sub">
            <span data-summary-items="fraquezas">0</span> itens avaliados
          </div>
        </div>
        <div class="summary-chip">
          <div class="summary-chip-header">
            <span class="summary-chip-title">Oportunidades</span>
            <span class="summary-chip-value" data-summary-score="oportunidades">0</span>
          </div>
          <div class="summary-chip-sub">
            <span data-summary-items="oportunidades">0</span> itens avaliados
          </div>
        </div>
        <div class="summary-chip">
          <div class="summary-chip-header">
            <span class="summary-chip-title">Amea√ßas</span>
            <span class="summary-chip-value" data-summary-score="ameacas">0</span>
          </div>
          <div class="summary-chip-sub">
            <span data-summary-items="ameacas">0</span> itens avaliados
          </div>
        </div>
      </div>

      <!-- For√ßas -->
      <section class="tab-content active" id="tab-forcas">
        <div class="gut-legend">
          <span class="gut-pill"><strong>Import√¢ncia:</strong> 1 Sem, 2 Pouco, 3 Importante, 4 Muito, 5 Totalmente</span>
          <span class="gut-pill"><strong>Intensidade:</strong> 1 Muito fraca ‚Üí 5 Muito forte</span>
          <span class="gut-pill"><strong>Tend√™ncia:</strong> 1 Piora muito ‚Üí 5 Melhora muito</span>
        </div>
        <div class="table-wrapper">
          <table id="table-forcas">
            <thead>
              <tr>
                <th style="width:26%">Descri√ß√£o</th>
                <th style="width:14%">Categoria</th>
                <th style="width:18%">Indicador</th>
                <th style="width:10%">Import√¢ncia</th>
                <th style="width:10%">Intensidade</th>
                <th style="width:10%">Tend√™ncia</th>
                <th style="width:8%">Pontua√ß√£o</th>
                <th style="width:4%">‚ãØ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="table-footer">
            <div class="table-footer-left">
              <button class="add-row-btn" onclick="addRow('forcas')">Ôºã Adicionar for√ßa</button>
            </div>
            <div class="table-footer-left">
              Total: <span class="table-footer-highlight" data-summary-items="forcas">0</span> itens
            </div>
          </div>
        </div>
      </section>

      <!-- Fraquezas -->
      <section class="tab-content" id="tab-fraquezas">
        <div class="gut-legend">
          <span class="gut-pill"><strong>Import√¢ncia:</strong> 1 Sem, 2 Pouco, 3 Importante, 4 Muito, 5 Totalmente</span>
          <span class="gut-pill"><strong>Intensidade:</strong> 1 Muito fraca ‚Üí 5 Muito forte</span>
          <span class="gut-pill"><strong>Tend√™ncia:</strong> 1 Piora muito ‚Üí 5 Melhora muito</span>
        </div>
        <div class="table-wrapper">
          <table id="table-fraquezas">
            <thead>
              <tr>
                <th style="width:26%">Descri√ß√£o</th>
                <th style="width:14%">Categoria</th>
                <th style="width:18%">Indicador</th>
                <th style="width:10%">Import√¢ncia</th>
                <th style="width:10%">Intensidade</th>
                <th style="width:10%">Tend√™ncia</th>
                <th style="width:8%">Pontua√ß√£o</th>
                <th style="width:4%">‚ãØ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="table-footer">
            <div class="table-footer-left">
              <button class="add-row-btn" onclick="addRow('fraquezas')">Ôºã Adicionar fraqueza</button>
            </div>
            <div class="table-footer-left">
              Total: <span class="table-footer-highlight" data-summary-items="fraquezas">0</span> itens
            </div>
          </div>
        </div>
      </section>

      <!-- Oportunidades -->
      <section class="tab-content" id="tab-oportunidades">
        <div class="gut-legend">
          <span class="gut-pill"><strong>Import√¢ncia:</strong> 1 Sem, 2 Pouco, 3 Importante, 4 Muito, 5 Totalmente</span>
          <span class="gut-pill"><strong>Intensidade:</strong> 1 Muito fraca ‚Üí 5 Muito forte</span>
          <span class="gut-pill"><strong>Tend√™ncia:</strong> 1 Piora muito ‚Üí 5 Melhora muito</span>
        </div>
        <div class="table-wrapper">
          <table id="table-oportunidades">
            <thead>
              <tr>
                <th style="width:26%">Descri√ß√£o</th>
                <th style="width:14%">Categoria</th>
                <th style="width:18%">Indicador</th>
                <th style="width:10%">Import√¢ncia</th>
                <th style="width:10%">Intensidade</th>
                <th style="width:10%">Tend√™ncia</th>
                <th style="width:8%">Pontua√ß√£o</th>
                <th style="width:4%">‚ãØ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="table-footer">
            <div class="table-footer-left">
              <button class="add-row-btn" onclick="addRow('oportunidades')">Ôºã Adicionar oportunidade</button>
            </div>
            <div class="table-footer-left">
              Total: <span class="table-footer-highlight" data-summary-items="oportunidades">0</span> itens
            </div>
          </div>
        </div>
      </section>

      <!-- Amea√ßas -->
      <section class="tab-content" id="tab-ameacas">
        <div class="gut-legend">
          <span class="gut-pill"><strong>Import√¢ncia:</strong> 1 Sem, 2 Pouco, 3 Importante, 4 Muito, 5 Totalmente</span>
          <span class="gut-pill"><strong>Intensidade:</strong> 1 Muito fraca ‚Üí 5 Muito forte</span>
          <span class="gut-pill"><strong>Tend√™ncia:</strong> 1 Piora muito ‚Üí 5 Melhora muito</span>
        </div>
        <div class="table-wrapper">
          <table id="table-ameacas">
            <thead>
              <tr>
                <th style="width:26%">Descri√ß√£o</th>
                <th style="width:14%">Categoria</th>
                <th style="width:18%">Indicador</th>
                <th style="width:10%">Import√¢ncia</th>
                <th style="width:10%">Intensidade</th>
                <th style="width:10%">Tend√™ncia</th>
                <th style="width:8%">Pontua√ß√£o</th>
                <th style="width:4%">‚ãØ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="table-footer">
            <div class="table-footer-left">
              <button class="add-row-btn" onclick="addRow('ameacas')">Ôºã Adicionar amea√ßa</button>
            </div>
            <div class="table-footer-left">
              Total: <span class="table-footer-highlight" data-summary-items="ameacas">0</span> itens
            </div>
          </div>
        </div>
      </section>

      <!-- Resumo SWOT -->
      <section class="tab-content" id="tab-resumo">
        <div class="resumo-radar-card">
          <div class="resumo-card-header">
            <div class="resumo-card-title">Radar SWOT</div>
            <div class="resumo-card-tag">Pontua√ß√£o total GUT por quadrante</div>
          </div>
          <canvas id="radar-swot"></canvas>
        </div>

        <div class="resumo-grid">
          <div class="resumo-card resumo-card-forcas">
            <div class="resumo-card-header">
              <div class="resumo-card-title">Top 5 For√ßas</div>
              <div class="resumo-card-tag" id="tag-forcas">0 itens</div>
            </div>
            <ol class="resumo-list" id="lista-forcas"></ol>
          </div>

          <div class="resumo-card resumo-card-oportunidades">
            <div class="resumo-card-header">
              <div class="resumo-card-title">Top 5 Oportunidades</div>
              <div class="resumo-card-tag" id="tag-oportunidades">0 itens</div>
            </div>
            <ol class="resumo-list" id="lista-oportunidades"></ol>
          </div>

          <div class="resumo-card resumo-card-fraquezas">
            <div class="resumo-card-header">
              <div class="resumo-card-title">Top 5 Fraquezas</div>
              <div class="resumo-card-tag" id="tag-fraquezas">0 itens</div>
            </div>
            <ol class="resumo-list" id="lista-fraquezas"></ol>
          </div>

          <div class="resumo-card resumo-card-ameacas">
            <div class="resumo-card-header">
              <div class="resumo-card-title">Top 5 Amea√ßas</div>
              <div class="resumo-card-tag" id="tag-ameacas">0 itens</div>
            </div>
            <ol class="resumo-list" id="lista-ameacas"></ol>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- L√≥gica JS (sem localStorage) -->
  <script>
    (function () {
      const tipos = ["forcas", "fraquezas", "oportunidades", "ameacas"];
      const labels = {
        forcas: "For√ßas",
        fraquezas: "Fraquezas",
        oportunidades: "Oportunidades",
        ameacas: "Amea√ßas"
      };

      const categoriasEstrategicas = [
        "",
        "Seguran√ßa",
        "Qualidade",
        "Custo",
        "Entrega / Prazo",
        "Produtividade / Opera√ß√µes",
        "Pessoas & Cultura",
        "Cliente / Mercado",
        "ESG / Comunidade",
        "Tecnologia & Dados",
        "Outro"
      ];

      // A√ß√µes em mem√≥ria (n√£o persiste entre acessos)
      let acoesSwot = {
        forcas: {},
        fraquezas: {},
        oportunidades: {},
        ameacas: {}
      };

      let radarChart = null;

      function initTabs() {
        const tabBtns = document.querySelectorAll(".tab-btn");
        const tabContents = document.querySelectorAll(".tab-content");

        tabBtns.forEach(btn => {
          btn.addEventListener("click", () => {
            const tab = btn.dataset.tab;
            if (!tab) return;

            tabBtns.forEach(b => b.classList.remove("active"));
            tabContents.forEach(c => c.classList.remove("active"));

            btn.classList.add("active");
            const content = document.getElementById("tab-" + tab);
            if (content) content.classList.add("active");

            if (tab === "resumo") {
              setTimeout(() => atualizarRadar(true), 0);
            }
          });
        });
      }

      function criarSelectCategoria() {
        const sel = document.createElement("select");
        sel.className = "swot-categoria";
        categoriasEstrategicas.forEach(v => {
          const opt = document.createElement("option");
          opt.value = v;
          opt.textContent = v === "" ? "-" : v;
          sel.appendChild(opt);
        });
        return sel;
      }

      function criarLinha(tipo) {
        const tr = document.createElement("tr");
        const placeholderPorTipo = {
          forcas: "Descreva a for√ßa de forma observ√°vel",
          fraquezas: "Descreva a fraqueza de forma observ√°vel",
          oportunidades: "Descreva a oportunidade",
          ameacas: "Descreva a amea√ßa"
        };
        const placeholder = placeholderPorTipo[tipo] || "Descreva o item";

        const opcoesGut = [1, 2, 3, 4, 5]
          .map(v => `<option value="${v}">${v}</option>`)
          .join("");

        tr.innerHTML = `
          <td><input type="text" class="swot-descricao" placeholder="${placeholder}"></td>
          <td class="td-categoria"></td>
          <td><input type="text" class="swot-indicador" placeholder="KPI / Indicador associado"></td>
          <td>
            <select class="gut-importancia">
              <option value="">-</option>
              ${opcoesGut}
            </select>
          </td>
          <td>
            <select class="gut-intensidade">
              <option value="">-</option>
              ${opcoesGut}
            </select>
          </td>
          <td>
            <select class="gut-tendencia">
              <option value="">-</option>
              ${opcoesGut}
            </select>
          </td>
          <td><span class="score-badge">0</span></td>
          <td class="row-actions">
            <button type="button" class="btn-icon btn-del" title="Remover">‚úï</button>
          </td>
        `;

        const tdCat = tr.querySelector(".td-categoria");
        if (tdCat) {
          const selCat = criarSelectCategoria();
          tdCat.appendChild(selCat);
        }

        const btnDel = tr.querySelector(".btn-del");
        if (btnDel) {
          btnDel.addEventListener("click", () => {
            tr.remove();
            atualizarResumoTipo(tipo);
          });
        }

        tr.querySelectorAll("select, input").forEach(el => {
          el.addEventListener("change", () => {
            recalcularLinha(tr);
            atualizarResumoTipo(tipo);
          });
        });

        return tr;
      }

      function recalcularLinha(tr) {
        const imp = Number(tr.querySelector(".gut-importancia")?.value || 0);
        const int = Number(tr.querySelector(".gut-intensidade")?.value || 0);
        const ten = Number(tr.querySelector(".gut-tendencia")?.value || 0);
        const score = imp * int * ten;
        const badge = tr.querySelector(".score-badge");
        if (badge) badge.textContent = score || 0;
        return score || 0;
      }

      function addRow(tipo) {
        const tbody = document.querySelector("#table-" + tipo + " tbody");
        if (!tbody) return;
        const tr = criarLinha(tipo);
        tbody.appendChild(tr);
      }

      window.addRow = addRow;

      function lerTabela(tipo) {
        const tbody = document.querySelector("#table-" + tipo + " tbody");
        if (!tbody) return [];
        const linhas = Array.from(tbody.querySelectorAll("tr"));
        return linhas.map(tr => {
          const desc = (tr.querySelector(".swot-descricao")?.value || "").trim();
          const cat = tr.querySelector(".swot-categoria")?.value || "";
          const indicador = (tr.querySelector(".swot-indicador")?.value || "").trim();
          const imp = Number(tr.querySelector(".gut-importancia")?.value || 0);
          const int = Number(tr.querySelector(".gut-intensidade")?.value || 0);
          const ten = Number(tr.querySelector(".gut-tendencia")?.value || 0);
          const score = imp * int * ten;
          const badge = tr.querySelector(".score-badge");
          if (badge) badge.textContent = score || 0;
          return {
            descricao: desc,
            categoria: cat,
            indicador: indicador,
            importancia: imp,
            intensidade: int,
            tendencia: ten,
            score
          };
        }).filter(item =>
          item.descricao !== "" ||
          item.categoria !== "" ||
          item.indicador !== "" ||
          item.importancia ||
          item.intensidade ||
          item.tendencia
        );
      }

      function lerContexto() {
        return {
          tema: document.getElementById("ctx-tema")?.value || "",
          objetivo: document.getElementById("ctx-objetivo")?.value || "",
          escopo: document.getElementById("ctx-escopo")?.value || "",
          periodo: document.getElementById("ctx-periodo")?.value || "",
          area: document.getElementById("ctx-area")?.value || "",
          time: document.getElementById("ctx-time")?.value || "",
          facilitador: document.getElementById("ctx-facilitador")?.value || "",
          data: document.getElementById("ctx-data")?.value || ""
        };
      }

      function atualizarRadar(force = false) {
        const canvas = document.getElementById("radar-swot");
        if (!canvas) return;

        if (typeof Chart === "undefined") {
          console.warn("Chart.js n√£o carregado; o gr√°fico de radar ficar√° desabilitado.");
          return;
        }

        const resumoTab = document.getElementById("tab-resumo");
        const tabVisivel = resumoTab && resumoTab.classList.contains("active");
        if (!tabVisivel && !force) {
          return;
        }

        const scores = tipos.map(t => {
          const span = document.querySelector(`[data-summary-score="${t}"]`);
          return span ? Number(span.textContent) || 0 : 0;
        });

        const data = {
          labels: tipos.map(t => labels[t]),
          datasets: [
            {
              label: "Pontua√ß√£o total GUT",
              data: scores,
              borderColor: "rgba(56,189,248,0.9)",
              backgroundColor: "rgba(56,189,248,0.22)",
              pointBackgroundColor: "#00a19a",
              pointBorderColor: "#e5fef3",
              pointRadius: 4,
              borderWidth: 2
            }
          ]
        };

        const options = {
          responsive: true,
          scales: {
            r: {
              angleLines: { color: "rgba(148,163,184,0.35)" },
              grid: { color: "rgba(30,64,175,0.45)" },
              pointLabels: {
                color: "#e2e8f0",
                font: { size: 10 }
              },
              ticks: {
                display: false
              }
            }
          },
          plugins: {
            legend: {
              display: true,
              labels: {
                color: "#e2e8f0",
                font: { size: 9 }
              }
            }
          }
        };

        const ctx = canvas.getContext("2d");

        if (radarChart) {
          radarChart.data = data;
          radarChart.options = options;
          radarChart.update();
        } else {
          radarChart = new Chart(ctx, {
            type: "radar",
            data,
            options
          });
        }
      }

      function atualizarResumoTipo(tipo) {
        const dados = lerTabela(tipo);

        const totalItensSpan = document.querySelector(`[data-summary-items="${tipo}"]`);
        const totalScoreSpan = document.querySelector(`[data-summary-score="${tipo}"]`);

        const totalItens = dados.length;
        const totalScore = dados.reduce((acc, item) => acc + (item.score || 0), 0);

        if (totalItensSpan) totalItensSpan.textContent = totalItens;
        if (totalScoreSpan) totalScoreSpan.textContent = totalScore;

        const lista = document.getElementById("lista-" + tipo);
        const tag = document.getElementById("tag-" + tipo);

        if (lista) {
          lista.innerHTML = "";
          const top5 = dados
            .slice()
            .sort((a, b) => (b.score || 0) - (a.score || 0))
            .slice(0, 5);

          top5.forEach(item => {
            const li = document.createElement("li");
            li.className = "resumo-item";

            const label = item.descricao || "(sem descri√ß√£o)";
            const chave = label;

            if (!acoesSwot[tipo]) acoesSwot[tipo] = {};
            const acaoSalva = acoesSwot[tipo][chave] || {
              contramedida: "",
              responsavel: "",
              prazo: "",
              status: ""
            };

            const tituloDiv = document.createElement("div");
            tituloDiv.className = "resumo-item-titulo";
            tituloDiv.textContent = `${label} ‚Äì Pontua√ß√£o: ${item.score || 0}`;

            const formDiv = document.createElement("div");
            formDiv.className = "resumo-item-form";

            const inpContr = document.createElement("input");
            inpContr.type = "text";
            inpContr.placeholder = "Plano de A√ß√£o";
            inpContr.value = acaoSalva.contramedida || "";

            const inpResp = document.createElement("input");
            inpResp.type = "text";
            inpResp.placeholder = "Respons√°vel";
            inpResp.value = acaoSalva.responsavel || "";

            const inpPrazo = document.createElement("input");
            inpPrazo.type = "date";
            inpPrazo.value = acaoSalva.prazo || "";

            const selStatus = document.createElement("select");
            const statusOpts = ["", "Backlog", "Planejado", "Em execu√ß√£o", "Conclu√≠do"];
            statusOpts.forEach(v => {
              const o = document.createElement("option");
              o.value = v;
              o.textContent = v === "" ? "Status" : v;
              selStatus.appendChild(o);
            });
            selStatus.value = acaoSalva.status || "";

            function salvarAcao() {
              acoesSwot[tipo][chave] = {
                contramedida: inpContr.value || "",
                responsavel: inpResp.value || "",
                prazo: inpPrazo.value || "",
                status: selStatus.value || ""
              };
            }

            [inpContr, inpResp, inpPrazo, selStatus].forEach(el => {
              el.addEventListener("change", salvarAcao);
            });

            formDiv.appendChild(inpContr);
            formDiv.appendChild(inpResp);
            formDiv.appendChild(inpPrazo);
            formDiv.appendChild(selStatus);

            li.appendChild(tituloDiv);
            li.appendChild(formDiv);

            lista.appendChild(li);
          });
        }

        if (tag) {
          tag.textContent = `${totalItens} item${totalItens === 1 ? "" : "s"}`;
        }

        atualizarRadar();
      }

      function atualizarTodosResumos() {
        tipos.forEach(t => atualizarResumoTipo(t));
      }

      function initExportacoes() {
        const btnPDF = document.getElementById("btnExportPDF");
        const btnExcel = document.getElementById("btnExportExcel");

        if (btnPDF) {
          btnPDF.addEventListener("click", () => {
            try {
              exportarPDF();
            } catch (e) {
              console.error(e);
              alert("Ocorreu um erro ao gerar o PDF. Verifique jsPDF/autotable.");
            }
          });
        }

        if (btnExcel) {
          btnExcel.addEventListener("click", () => {
            try {
              exportarExcel();
            } catch (e) {
              console.error(e);
              alert("Ocorreu um erro ao gerar o Excel. Verifique a biblioteca XLSX.");
            }
          });
        }
      }

      function exportarPDF() {
        const jspdfNS = window.jspdf;
        if (!jspdfNS || !jspdfNS.jsPDF) {
          alert("Biblioteca jsPDF n√£o encontrada.");
          return;
        }
        const doc = new jspdfNS.jsPDF({ orientation: "landscape" });

        const ctx = lerContexto();
        doc.setFontSize(14);
        doc.text("Contexto do A3 estrat√©gico", 10, 10);
        doc.setFontSize(10);
        const linhasCtx = [
          `Tema: ${ctx.tema || ""}`,
          `Objetivo estrat√©gico: ${ctx.objetivo || ""}`,
          `Escopo / Fronteiras: ${ctx.escopo || ""}`,
          `Per√≠odo: ${ctx.periodo || ""}`,
          `√Årea / Unidade: ${ctx.area || ""}`,
          `Time / Workshop: ${ctx.time || ""}`,
          `Facilitador: ${ctx.facilitador || ""}`,
          `Data da sess√£o: ${ctx.data || ""}`
        ];
        let yCtx = 18;
        linhasCtx.forEach(l => {
          doc.text(l, 10, yCtx);
          yCtx += 5;
        });

        tipos.forEach(tipo => {
          doc.addPage();

          const titulo = "Matriz SWOT + GUT ‚Äì " + labels[tipo];
          doc.setFontSize(14);
          doc.text(titulo, 10, 10);

          const dados = lerTabela(tipo);
          const body = dados.map(d => [
            d.descricao || "",
            d.categoria || "",
            d.indicador || "",
            d.importancia || "",
            d.intensidade || "",
            d.tendencia || "",
            d.score || 0
          ]);

          if (typeof doc.autoTable === "function") {
            doc.autoTable({
              startY: 16,
              head: [[
                "Descri√ß√£o",
                "Categoria",
                "Indicador",
                "Import√¢ncia",
                "Intensidade",
                "Tend√™ncia",
                "Pontua√ß√£o"
              ]],
              body
            });
          } else {
            let y = 20;
            doc.setFontSize(10);
            body.forEach(row => {
              const linha = row.join(" | ");
              doc.text(linha, 10, y);
              y += 6;
            });
          }
        });

        doc.save("matriz-swot-gut-a3.pdf");
      }

      function exportarExcel() {
        if (typeof XLSX === "undefined") {
          alert("Biblioteca XLSX n√£o encontrada.");
          return;
        }

        const wb = XLSX.utils.book_new();

        const ctx = lerContexto();
        const wsCtxData = [
          ["Campo", "Valor"],
          ["Tema", ctx.tema || ""],
          ["Objetivo estrat√©gico", ctx.objetivo || ""],
          ["Escopo / Fronteiras", ctx.escopo || ""],
          ["Per√≠odo", ctx.periodo || ""],
          ["√Årea / Unidade", ctx.area || ""],
          ["Time / Workshop", ctx.time || ""],
          ["Facilitador", ctx.facilitador || ""],
          ["Data da sess√£o", ctx.data || ""]
        ];
        const wsCtx = XLSX.utils.aoa_to_sheet(wsCtxData);
        XLSX.utils.book_append_sheet(wb, wsCtx, "Contexto A3");

        tipos.forEach(tipo => {
          const dados = lerTabela(tipo);
          const linhas = dados.map(d => ({
            Descri√ß√£o: d.descricao || "",
            Categoria: d.categoria || "",
            Indicador: d.indicador || "",
            Import√¢ncia: d.importancia || "",
            Intensidade: d.intensidade || "",
            Tend√™ncia: d.tendencia || "",
            Pontua√ß√£o: d.score || 0
          }));

          const ws = XLSX.utils.json_to_sheet(linhas);
          XLSX.utils.book_append_sheet(wb, ws, labels[tipo].substring(0, 31));
        });

        XLSX.writeFile(wb, "matriz-swot-gut-a3.xlsx");
      }

      document.addEventListener("DOMContentLoaded", () => {
        initTabs();
        initExportacoes();

        // Sempre come√ßa com 1 linha em branco em cada tabela
        tipos.forEach(t => addRow(t));

        atualizarTodosResumos();
      });
    })();
  </script>
</body>
</html>
